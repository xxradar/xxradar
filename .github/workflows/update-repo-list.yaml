name: Update repo list 
on: 
  workflow_dispatch:

jobs:
  create-and-commit-file:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2


    - name: Commit and Push
      run: |
        git config --global user.name 'xxradar'
        git config --global user.email 'xxradar@radarhack.com'
        # Set the starting page number
        page=1

        # Initialize an empty array to store the repository names
        repos=()

        # Loop through all pages of results until we reach an empty page
        while true; do
          # Send a GET request to the Github API to fetch the list of repositories for the current page
          response=$(curl -s -H "Authorization: Bearer "${{ secrets.GITHUB_TOKEN }}" -H "X-GitHub-Api-Version: 2022-11-28" -H "Accept: application/vnd.github+json" "https://api.github.com/user/repos?per_page=100&page=$page&type=owner")

          # If the response is an empty array, we have reached the end of the results
          if [ "$(echo "$response" | jq '. | length')" -eq 0 ]; then
            break
          fi

          # Parse the JSON response and extract the names of the repositories
          #echo $response
          page_repos=$(echo "$response" | jq -r '.[].full_name')

          # Add the repository names to the list of all repositories
         repos+=( $page_repos )

          # Increment the page number
          page=$((page + 1))
       done

       #echo "List of all your repositories on GitHub:"
       #printf '%s\n' "${repos[@]}"

       for i in "${repos[@]}"
       do
       printf '\055 [https://github.com/%s](https://github.com/%s)\n' $i $i
       done
